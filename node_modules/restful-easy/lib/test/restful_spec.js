'use strict';

//start test server
var rest = require('../restful'),
/*jshint -W079*/
    chai = require('chai'),
    expect = chai.expect,
    app,
    endpoint;


describe('restful client', function() {
    before(function() {
        app = require("../../test/server");
        endpoint = rest('http://localhost:3011/artifacts');
    });

    describe('get', function() {
        it('with query param', function() {
            return endpoint.get(['mindtap'], {sort: 'ascending'}).then(function(result) {
                expect(result).to.eql([ 'mindtap.1', 'mindtap.2' ]);
            });
        });

        it('without query param', function() {
            return endpoint.get(['mindtap']).then(function(result) {
                expect(result).to.eql([ 'mindtap.2', 'mindtap.1']);
            });
        });
    });

    describe('post', function() {
        it('post without query params', function() {
            return endpoint.post({"foo": "bar"}).then(function(result) {
                expect(result).to.eql({
                    "name": "mindTap",
                    "version": "1.1.0",
                    "dependencies": {
                        "dep1": "3.3.3"
                    }
                });
            });
        });

        it('post with query params', function() {
            return endpoint.post({"foo": "bar"}, {"type": "resolved"}).then(function(result) {
                expect(result).to.eql({
                    "name": "mindTap",
                    "version": "1.1.0",
                    "dependencies": {
                        "dep1": {
                            "name": "dep1",
                            "version": "3.3.3"
                        }
                    }
                });
            });
        });
    });

});